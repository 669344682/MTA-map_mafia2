local eb_textures = engineLoadTXD ( ":map_mafia2/eb_textures.txd" )

local kingstone = {
	--объекты
	{"teren0", {{-1204.44200, 1429.81300, -8.26321, 90, 0, 0}}, 0},
	{"teren1", {{-1337.13700, 1197.12900, -19.87857, 90, 0, 0}}, 0},
	{"teren2", {{-1198.80000, 1248.14300, -19.91991, 90, 0, 0}}, 0},
	--{"teren3", {{-1650.80900, 1692.52800, 2.05191, 90, 0, 0}}, 0},
	--{"teren4", {{-1451.41700, 1807.72800, 9.42347, 90, 0, 0}}, 0},
	--{"teren5", {{-1287.17800, 1797.35500, 15.24572, 90, 0, 0}}, 0},
	--{"teren6", {{-1085.39000, 1797.35500, 10.50450, 90, 0, 0}}, 0},
	{"teren7", {{-964.84580, 1654.89300, 7.83806, 90, 0, 0}}, 0},
	{"teren8", {{-1116.54600, 1601.18200, 3.27992, 90, 0, 0}}, 0},
	{"teren9", {{-1003.10600, 1410.77600, -14.00727, 90, 0, 0}}, 0},
	{"teren10", {{-1349.63700, 1604.33000, 2.60039, 90, 0, 0}}, 0},
	{"teren11", {{-1561.34300, 1590.94100, -3.09693, 90, 0, 0}}, 0},
	{"teren12", {{-1394.53000, 1408.82500, -8.76358, 90, 0, 0}}, 0},
	--{"teren13", {{-1174.98700, 1147.74200, -30.72144, 90, 0, 0}}, 0},
	{"tunel7", {{-622.97620, 1344.20400, -29.87234, 90, 0, 0}}, 0},
	{"tunel4", {{-622.97620, 1344.20400, -29.87234, 90, 0, 0}}, 0},
	{"tunel5", {{-622.97620, 1344.20400, -29.87234, 90, 0, 0}}, 0},
	{"tunel3", {{-622.97620, 1344.20400, -31.87234, 90, 0, 0}}, 0},
	{"tunel0", {{-622.97620, 1344.20400, -31.87234, 90, 0, 0}}, 0},
	{"tunel1", {{-622.97620, 1344.20400, -29.87234, 90, 0, 0}}, 0},
	{"rantl6", {{-1070.41900, 1523.53100, 1.51440, 90, 0, 0}}, 0},
	{"rantl8", {{-1043.01200, 1409.40500, -9.67674, 90, 0, 0}}, 0},
	{"rantl9", {{-1151.84300, 1421.08100, -8.16802, 90, 0, 0}}, 0},
	{"rantl13", {{-1504.13600, 1556.09400, -6.97555, 90, 0, -90}}, 0},
	{"rantl14", {{-1479.56400, 1501.99700, -9.77325, 90, 0, 0}}, 0},
	{"rantl15", {{-1420.28900, 1453.08000, -9.31285, 90, 0, -90}}, 0},
	{"rantl16", {{-1495.49400, 1669.62600, 0.77649, 90, 0, -90}}, 0},
	{"rantl21", {{-1127.41200, 1368.93500, -14.22700, 90, 0, 180}}, 0},
	{"Subway", {{-1117.77300,1376.64800,-17.50235,90,0,0}}, 0},
	{"04_tunel_portal", {{-878.27620, 1390.79200, -24.14059, 90, 0, 0}}, 0},
	{"04_moloA", {{-1077.21400, 1323.41800, -24.08780, 90, 0, 0}}, 0},
	{"04_moloB", {{-1003.06900, 1316.76700, -24.08780, 90, 0, 0}}, 0},
	{"04_moloC", {{-1119.15100, 1222.68200, -24.08780, 90, 0, 0}}, 0},
	{"04_moloD", {{-1119.15100, 1302.39500, -24.08780, 90, 0, 0}}, 0},
	{"04_rantl01A", {{-1007.66800,1347.22600,-19.24800,90,0,0}}, 0},
	{"04_rantl02A", {{-1063.30100,1347.22600,-19.24800,90,0,0}}, 0},
	{"04_rantl03A", {{-1182.24300,1207.90800,-17.23683,90,0,0}}, 0},
	{"04_rantl03B", {{-1119.15100,1206.61200,-22.82823,90,0,0},{-1119.15100,1318.93900,-22.82823, 90,0,180}}, 0},
	{"04_rantl03C", {{-1172.13200,1260.76000,-17.09620,90,0,0}}, 0},
	{"04_rantl04A", {{-1292.93200,1166.94500,-19.23755,90,0,0}}, 0},
	{"04_rantl04B", {{-1206.91700,1166.94500,-19.24800,90,0,0}}, 0},
	{"04_rantl05A", {{-1359.85500,1119.77300,-19.92285,90,0,0}}, 0},
	{"04_rantl05B", {{-1282.72800,1140.60500,-24.75047,90,0,0}}, 0},
	{"04_rantl05C", {{-1323.28200,1133.36400,-20.06538,90,0,0}}, 0},
	{"04_rantl07A", {{-1176.53600,1619.63900,8.62659,90,0,0}}, 0},
	{"04_rantl07B", {{-1194.15900,1648.59800,9.44057,90,0,0}}, 0},
	{"04_rantl07C", {{-994.32150,1651.06100,9.48711,90,0,0}}, 0},
	{"04_rantl07D", {{-1128.46400,1541.55500,4.61663,90,0,0}}, 0},
	{"04_rantl07E", {{-1200.15100,1539.49300,2.34151,90,0,0}}, 0},
	{"04_schudky", {{-1431.06500,1660.22600,5.83288,90,0,0}}, 0},
	{"04_rantl10A", {{-1419.56800,1601.90000,1.18277,90,0,0}}, 0},
	{"04_rantl10B", {{-1401.12300,1553.50500,1.80054,90,0,0}}, 0},
	{"04_rantl12A", {{-1293.65300,1523.79500,-3.46030,90,0,0}}, 0},
	{"04_rantl12C", {{-1283.38900,1442.35100,-7.93181,90,0,0}}, 0},
	{"04_rantl12D", {{-1323.30000,1429.04000,-9.84217,90,0,0}}, 0},
	{"04_rantl12E", {{-1317.04100,1538.98600,0.95081,90,0,0}}, 0},
	{"04_rantl12F", {{-1222.86000,1537.95600,2.18715,90,0,0}}, 0},
	{"04_rantl17A", {{-1467.08200,1453.16100,-12.08815,90,0,0}}, 0},
	{"04_rantl17B", {{-1393.32900,1501.24600,-3.03211,90,0,-90}}, 0},
	{"04_rantl18A", {{-1531.46200,1634.46500,-4.24416,90,0,-90}}, 0},
	{"04_rantl18C", {{-1564.68800,1668.15900,-3.13756,90,0,-90}}, 0},
	{"04_rantl19A", {{-1169.37900,1319.43200,-19.24800,90,0,0}}, 0},
	{"04_rantl19C", {{-1131.76100,1350.19000,-19.24800,90,0,0}}, 0},
	{"04_rantl20A", {{-1288.34700,1646.62600,9.81464,90,0,0}}, 0},--к ней можно попасть?
	{"04_rantl20B", {{-1348.90300,1616.72500,9.60061,90,0,0}}, 0},--?
	{"04_rantl20C", {{-1329.97300,1588.20400,5.03857,90,0,0}}, 0},--?
	{"04_rantl20D", {{-1235.94600,1658.60500,10.06001,90,0,0}}, 0},
	{"04_rantl20E", {{-1225.28500,1607.25600,6.75437,90,0,0}}, 0},
	{"04_rantl22A", {{-932.91530,1361.10400,-19.24800,90,0,0}}, 0},
	{"04_rantl22C", {{-941.62000,1372.01700,-19.24800,90,0,0}}, 0},
	{"04_schodynoveuFF", {{-1611.38900,1659.00400,-2.04312,90,0,-90}}, 0},
	{"04_plot01", {{-1033.77700,1730.94000,12.03265,90,0,0}}, 0},
	{"04_plot02A", {{-1383.20600,1698.44200,11.64970,90,0,0}}, 0},
	{"04_plot02B", {{-897.83040,1608.76200,8.74751,90,0,0}}, 0},
	{"04_plot02C", {{-928.39200,1654.52600,9.53383,90,0,0}}, 0},
	{"04_plot02D", {{-1159.20800,1525.22400,8.33719,90,0,0}}, 0},
	{"04_plot02E", {{-1251.41300,1658.24200,12.60255,90,0,0}}, 0},
	--{"04_plot02F", {{-1395.06000,1523.90900,0.02963,90,0,0}}, 0},--?
	{"04_plot02G", {{-1412.83300,1622.86200,7.05948,90,0,0}}, 0},
	{"04_plot02H", {{-1334.78100,1654.91600,12.72993,90,0,0}}, 0},
	{"04_plot02I", {{-1391.32700,1662.34900,11.64056,90,0,0}}, 0},
	{"04_plot03A", {{-1614.82800,1621.15600,-4.21066,90,0,-87.13084}}, 0},
	{"04_plot03C", {{-1623.60000,1647.64100,-3.71399,90,0,-87.13084}}, 0},
	{"04_plot03D", {{-1632.77700,1588.20600,-4.44831,90,0,-87.13084}}, 0},
	{"04_plot04A", {{-1610.86700,1607.49200,-6.92486,90,0,0}}, 0},
	{"04_plot04D", {{-1585.85100,1582.51800,-6.83593,90,0,0}}, 0},
	{"04_plot05A", {{-1568.17000,1537.82700,-7.15344,90,0,0}}, 0},
	{"04_plot05B", {{-1465.75600,1412.23600,-11.91205,90,0,0}}, 0},
	{"04_plot05C", {{-1511.27600,1484.88000,-9.26496,90,0,0}}, 0},
	{"04_blok103", {{-1465.53900,1371.84100,-11.31216,90,0,90}}, 0},
	{"04_blok100", {{-1425.82000,1199.87700,-7.77546,90,0,90}}, 0},
	{"04_blok01", {{-1069.64200,1408.97800,0.81039,90,0,0}}, 0},
	{"04_blok02", {{-1087.84400,1438.30300,15.17464,90,0,0}}, 0},
	{"04_blok03", {{-1210.89200,1407.67400,5.70109,90,0,0}}, 0},
	{"04_blok04", {{-1267.56200,1409.88000,5.03549,90,0,0}}, 0},
	{"04_blok05", {{-1189.95500,1434.32900,23.03174,90,0,0}}, 0},
	{"04_blok06", {{-1182.33900,1405.08900,4.85869,90,0,0}}, 0},
	{"04_blok07", {{-1241.06400,1400.02600,3.45755,90,0,0}}, 0},
	{"04_blok08", {{-1267.30300,1438.49200,11.51988,90,0,0}}, 0},
	{"04_blok09", {{-1230.78500,1437.10100,9.86176,90,0,0}}, 0},
	{"04_blok10", {{-1161.72400,1341.82100,-17.52925,90,0,0}}, 0},
	{"04_blok11", {{-1139.57700,1408.99900,5.93081,90,0,0}}, 0},
	{"04_blok12", {{-1102.47200,1408.94200,2.02725,90,0,0}}, 0},
	{"04_blok13", {{-1143.12200,1438.31200,16.98560,90,0,0}}, 0},
	{"04_blok14", {{-1070.65300,1519.18600,4.87858,90,0,0}}, 0},
	{"04_blok15", {{-1140.41400,1541.72600,15.47883,90,0,0}}, 0},
	{"04_blok16", {{-1188.80700,1504.60200,22.71194,90,0,0}}, 0},
	{"04_blok17", {{-1194.32900,1542.36300,15.32266,90,0,0}}, 0},
	{"04_blok18", {{-1164.42000,1541.96100,10.14262,90,0,0}}, 0},
	{"04_blok19", {{-1239.87500,1503.11000,20.38561,90,0,0}}, 0},
	{"04_blok20", {{-1273.29800,1504.78800,21.30469,90,0,0}}, 0},
	{"04_blok21", {{-1239.79300,1538.93100,17.10602,90,0,0}}, 0},
	{"04_blok22", {{-1266.44700,1540.34400,18.49484,90,0,0}}, 0},
	{"04_blok23", {{-1137.42900,1506.93100,13.69519,90,0,0}}, 0},
	{"04_blok24", {{-1161.72000,1498.46800,0.05940,90,0,0}}, 0},
	{"04_blok25", {{-984.77770,1588.14800,10.85401,90,0,0}}, 0},
	{"04_blok26", {{-1014.23200,1587.79800,15.58196,90,0,0}}, 0},
	{"04_blok27", {{-1046.59100,1601.87400,11.26845,90,0,0}}, 0},
	{"04_blok28", {{-1061.15700,1613.98600,14.47986,90,0,0}}, 0},
	{"04_blok29", {{-1085.02000,1588.30800,15.15809,90,0,0}}, 0},
	{"04_blok30", {{-1118.19300,1587.79800,19.48488,90,0,0}}, 0},
	{"04_blok31", {{-1146.78700,1590.42400,13.72193,90,0,-90}}, 0},
	{"04_blok32", {{-1183.51100,1603.94400,9.38411,90,0,0}}, 0},
	{"04_blok33", {{-1149.34900,1615.47000,18.55134,90,0,0}}, 0},
	{"04_blok34", {{-1128.28200,1639.81000,20.16640,90,0,0}}, 0},
	{"04_blok35", {{-1150.80300,1649.75800,12.96429,90,0,0}}, 0},
	{"04_blok36", {{-1128.41800,1668.80200,21.06348,90,0,0}}, 0},
	{"04_blok37", {{-1174.56400,1645.80600,16.45051,90,0,0}}, 0},
	{"04_blok38", {{-1191.66900,1641.21700,22.03114,90,0,0}}, 0},
	{"04_blok39", {{-1177.69500,1666.89400,20.69523,90,0,0}}, 0},
	{"04_blok40", {{-1096.82300,1658.99400,23.47086,90,0,0}}, 0},
	{"04_vylhaapliance", {{-1137.38300,1489.39400,-1.22186,90,0,-90}}, 0},
	{"04_blok_interier01", {{-1163.10200,1590.40800,8.58762,90,0,0}}, 0},
	{"IRISH", {{-1151.66600,1578.99500,7.39509,90,0,0}}, 0},
	{"04_224", {{-1137.68800,1489.13600,-2.88507,90,0,0}}, 0},
	{"04_blok41", {{-1067.49900,1650.33200,18.44675,90,0,0}}, 0},
	{"04_blok42", {{-1018.76800,1623.95100,16.37898,90,0,0}}, 0},
	{"04_blok43", {{-1042.03700,1650.89200,16.40739,90,0,0}}, 0},
	{"04_blok44", {{-1376.19000,1589.52900,20.59987,90,0,0}}, 0},
	{"04_blok45", {{-992.91380,1631.39100,14.12483,90,0,0}}, 0},
	{"04_blok46", {{-1354.51500,1702.06500,16.14933,90,0,0}}, 0},
	{"04_blok47", {{-1308.03600,1706.24600,16.21890,90,0,0}}, 0},
	{"04_blok48", {{-1248.09100,1706.27100,16.97486,90,0,0}}, 0},
	{"04_blok49", {{-1196.40000,1711.59600,15.67256,90,0,0}}, 0},
	{"04_blok50", {{-1163.11500,1701.55700,13.88185,90,0,0}}, 0},
	{"04_blok51", {{-1128.15600,1707.21100,16.93103,90,0,0}}, 0},
	{"04_blok52", {{-1087.99600,1706.10600,17.55642,90,0,0}}, 0},
	{"04_blok53", {{-1060.27200,1716.47500,16.30147,90,0,0}}, 0},
	{"04_blok57", {{-1320.98700,1661.09100,19.81383,90,0,0}}, 0},
	{"04_blok58", {{-1292.68000,1660.76000,19.07372,90,0,0}}, 0},
	{"04_blok59", {{-1264.47500,1663.39100,16.88951,90,0,0}}, 0},
	{"04_blok60", {{-1236.16000,1655.02600,19.20650,90,0,0}}, 0},
	{"04_blok61", {{-1238.54600,1615.99200,13.73693,90,0,0}}, 0},
	{"04_blok62", {{-1239.86900,1589.05800,9.10718,90,0,0}}, 0},
	{"04_blok63", {{-1263.84000,1599.23500,9.98103,90,0,0}}, 0},
	{"04_blok64", {{-1303.60800,1595.27200,10.19828,90,0,0}}, 0},
	{"04_blok65", {{-1299.44400,1611.58100,11.47969,90,0,0}}, 0},
	{"Harry", {{-1292.32900,1608.84200,5.49150,90,0,0}}, 0},
	{"odevy", {{-1295.63800,1697.73800,12.51401,90,0,0}}, 0},
	{"04_blok_interier02", {{-1181.87400,1699.07400,13.40547,90,0,0}}, 0},
	{"GUNSHOP", {{-1181.05800,1699.61600,12.78120,90,0,-180}}, 0},
}

local start = true
addEventHandler( "onClientResourceStart", resourceRoot,
function ( startedRes )
	if start then
		start = false
		
		for i=550,20000 do
			removeWorldModel(i,10000,0,0,0)
		end
		setOcclusionsEnabled(false)
		setWaterLevel(-5000)

		local count = 0
		for k,v in pairs(getElementData(resourceRoot, "objectNames")) do
			count = count+1
			kingstone[count][3] = k

			if count == #kingstone then
				break
			end
		end
		
		for k,v in ipairs(kingstone) do
			engineImportTXD (eb_textures, v[3])
			local dff = engineLoadDFF ( ":map_mafia2/kingstone/"..v[1]..".dff" )
			engineReplaceModel ( dff, v[3] )
			local col = engineLoadCOL ( ":map_mafia2/kingstone/"..v[1]..".col" )
			engineReplaceCOL ( col, v[3] )

			for k,j in ipairs(v[2]) do
				local obj = createObject(v[3], j[1],j[2],j[3], j[4],j[5],j[6])
				setElementFrozen(obj, true)
				setObjectBreakable(obj, false)
			end

			engineSetModelLODDistance(v[3], 30000)

			print(v[1], v[3])
		end
	end
end)

local function dxdrawtext(text, x, y, width, height, color, scale, font)
	dxDrawText ( text, x+1, y+1, width, height, tocolor ( 0, 0, 0, 255 ), scale, font )

	dxDrawText ( text, x, y, width, height, color, scale, font )
end

local hud = true
function createText ()
	if hud then
		setTime(15, 0)
		local x,y,z = getElementPosition(localPlayer)
		for k,v in ipairs(kingstone) do
			for k,j in ipairs(v[2]) do
				if getDistanceBetweenPoints3D(x, y, z, j[1],j[2],j[3]) <= 100 then
					local coords = { getScreenFromWorldPosition( j[1],j[2],j[3]+1, 0, false ) }
					if coords[1] and coords[2] then
						dxdrawtext ( v[1], coords[1]-(dxGetTextWidth ( v[1], 1, "default-bold" )/2), coords[2]-15, 0.0, 0.0, tocolor ( 255, 255, 255, 255 ), 1, "default-bold" )
						dxdrawtext ( v[3], coords[1]-(dxGetTextWidth ( v[3], 1, "default-bold" )/2), coords[2]-15*2, 0.0, 0.0, tocolor ( 255, 255, 255, 255 ), 1, "default-bold" )
					end
				end
			end
		end
	end
end
addEventHandler ( "onClientRender", root, createText )